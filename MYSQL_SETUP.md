# Настройка подключения к MySQL

## Текущие настройки

Ваше подключение к MySQL уже настроено в `web_app.py`:

```python
DB_CONFIG = {
    'type': 'mysql',
    'host': 'sql313.infinityfree.com',
    'port': 3306,
    'database': 'if0_40442945_XXX',  # ⚠️ ВАЖНО: Замените XXX на реальное имя БД
    'user': 'if0_40442945',
    'password': 'Asdf55520071'
}
```

## Шаг 1: Проверка имени базы данных

**ВАЖНО:** В настройках указано `if0_40442945_XXX`, но вам нужно заменить `XXX` на реальное имя вашей базы данных.

Проверьте в панели управления хостингом точное имя базы данных и обновите строку:
```python
'database': 'if0_40442945_XXX',  # Замените на реальное имя
```

## Шаг 2: Установка зависимостей

```bash
pip install PyMySQL
```

## Шаг 3: Тестирование подключения

Запустите тестовый скрипт:

```bash
python test_mysql_connection.py
```

Если подключение успешно, вы увидите:
- ✓ Подключение успешно!
- Версию MySQL
- Список таблиц
- Количество пользователей

Если есть ошибки, проверьте:
1. Правильность имени базы данных
2. Доступность сервера
3. Правильность учетных данных

## Шаг 4: Обновление bot_main.py для работы с MySQL

Чтобы бот и веб-приложение работали с одной БД, обновите `bot_main.py`:

### Замените:
```python
conn = sqlite3.connect("students.db", check_same_thread=False)
cursor = conn.cursor()
```

### На:
```python
import pymysql

conn = pymysql.connect(
    host='sql313.infinityfree.com',
    port=3306,
    database='if0_40442945_XXX',  # Замените XXX на реальное имя
    user='if0_40442945',
    password='Asdf55520071',
    cursorclass=pymysql.cursors.DictCursor,
    autocommit=True
)
cursor = conn.cursor()
```

### Важные изменения для MySQL:

1. **Параметры запросов:** Замените `?` на `%s` во всех SQL запросах:
   ```python
   # Было (SQLite):
   cursor.execute("SELECT * FROM users WHERE user_id = ?", (user_id,))
   
   # Стало (MySQL):
   cursor.execute("SELECT * FROM users WHERE user_id = %s", (user_id,))
   ```

2. **AUTOINCREMENT:** В MySQL используется `AUTO_INCREMENT` вместо `AUTOINCREMENT`

3. **Типы данных:** Некоторые типы могут отличаться

4. **Результаты запросов:** В MySQL с `DictCursor` результаты возвращаются как словари, а не как кортежи

## Шаг 5: Миграция данных (если нужно)

Если у вас уже есть данные в SQLite и нужно перенести их в MySQL:

1. Экспортируйте данные из SQLite
2. Импортируйте в MySQL
3. Проверьте целостность данных

## Решение проблем

### Ошибка: "Access denied"
- Проверьте логин и пароль
- Убедитесь, что пользователь имеет права на базу данных

### Ошибка: "Unknown database"
- Проверьте имя базы данных
- Убедитесь, что база данных создана

### Ошибка: "Can't connect to MySQL server"
- Проверьте доступность сервера
- Проверьте firewall настройки
- Убедитесь, что порт 3306 открыт

### Ошибка синтаксиса SQL
- Убедитесь, что все `?` заменены на `%s` для MySQL
- Проверьте совместимость типов данных

## Проверка работы

После настройки:

1. Запустите веб-приложение: `python web_app.py`
2. Откройте в браузере: `http://localhost:5000`
3. Попробуйте авторизоваться
4. Проверьте работу всех функций

Если все работает, бот и веб-приложение теперь используют одну и ту же БД на удаленном сервере!

